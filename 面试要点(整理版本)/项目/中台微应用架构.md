### 微前端的概念

### 路由转发
但是如果我们将路由跳转交给服务端，当我们访问一个路由的时候，后端进行重定向等操作，这样就会将我们的应用隔离开。
例如： http://www.xxxx.com/a与http://wwww.xxxx.com/b，当后端收到a路由的时候，指向一个系统，
当收到b路由的时候指向另外一个系统，这样我的系统开发所采用的技术栈就可以进行隔离。
如果要分享用户信息等，可以通过cookie等技术进行分享。因为每次路由匹配到的话，都会进行刷新，因此也防止了JS，css的污染问题

优点： 简单，可快速配置。
缺点：每次跳转都相当于重新刷新了一次页面，不是页面内进行跳转。影响体验。



### 最简单的微前端基石方案：iframe
iframe具有天然的JS和css隔离

在信息共享方面，我们可以使用postMessage或者contentWindow的方式进行。

优点： iframe具有天然的JS和css隔离
缺点：
- 主应用劫持快捷键操作
- iframe 内元素会被限制在文档树中，视窗宽高限制问题，内嵌的 iframe 并不会自动调节宽高
- 无法共享基础库进一步减少包体积
- 事件通信繁琐且限制多
- 父子之间的网页链接是不同步的，浏览器一刷新，iframe 中的状态就没了，后退、前进按钮无法使用；
- 最后是慢，每次进子应用，浏览器都需要重新完整加载资源。




### 组合式应用路由分发

每个子应用单独的打包，部署和运行。
不过需要基于父应用进行路由管理。
例如：有子应用A的路由是/testA，子应用B的路由是/testB，那么父应用在监听到/testA的时候，如果此时处于/testB，那么首先会进行一个子应用B的卸载。
完成之后，在去加载子应用A。


优点：纯前端改造，相比于路由式，无刷新，体验感良好。
缺点：需要解决样式冲突，JS污染问题，通信技术等。


### 应用加载、沙箱隔离与内部通信三个方向解析 qiankun。

#### 你为什么不使用乾坤以及single-spa

乾坤 2019.8.01 才发布第一个正式的版本v1.1.4 release,
而我们的应用是在2019年中旬就完成了改造的，当时可以借鉴的方案只有single-spa，
所以也研究了single-spa的源码来解决这个问题。
single-spa 2016.7.13 发布第一个 v2.1.3 release


#### 微前端的改造
- 为什么工程需要切换到微前端
    3条业务线的前端团队都往一个仓库里加代码。随着业务的壮大，代码越来越多，协调代码合并、协调发版周期就越来越复杂。甚至有时候光是发版后又回滚，回滚后又发版都要折腾好几轮。如果业务蓬勃发展，团队人越来越多，单一工程上提交代码、合并代码、部署代码的节奏必然会被打乱。
- 改造的核心点
    因此第一步你得先有方案，这个方案要包括已验证的原型及成本收益评估，然后要有改造拆分的迭代计划，最后还得有翻车事故的预案保证线上能够在事故发生后快速回滚。这才是真实世界里中大型项目的改造流程。
    - 验证原型阶段需要从原工程中切出一个测试分支，验证业务是否可拆、拆分后是否可运行、对线上的影响有多大，然后输出文档。
    - 成本/收益评估阶段需要全盘考虑改造的成本，改动的范围是否可控，是否需要在团队内部进行培训学习？从收益角度来讲需要核算改造后节省的人效。
    - 在开发阶段节省的人效，才能当作收益。其实并不是这样，一次业务迭代流程周期应该拉通来看，如果沟通成本、协调成本、部署成本，能从周期中缩减下来，那也是提升的人效，也能加快业务交付，所以同样应当算作收益。
- 改造后，工作模式的切换，效率的提高










